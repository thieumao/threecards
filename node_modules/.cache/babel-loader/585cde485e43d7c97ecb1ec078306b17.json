{"ast":null,"code":"import _createForOfIteratorHelper from\"/Users/thieunguyen/Desktop/Project/ReactJS/web-ets-2020/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _regeneratorRuntime from\"/Users/thieunguyen/Desktop/Project/ReactJS/web-ets-2020/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/thieunguyen/Desktop/Project/ReactJS/web-ets-2020/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/thieunguyen/Desktop/Project/ReactJS/web-ets-2020/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Users/thieunguyen/Desktop/Project/ReactJS/web-ets-2020/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";function _templateObject(){var data=_taggedTemplateLiteral([\"\\n  width: 100%;\\n  height: 100%;\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import Screen from'../Screen';import React,{useState,useEffect}from'react';import{FlatList}from'react-native';import styled from'styled-components/native';import{useParams}from'react-router-dom';import textAPI from\"../../api/textAPI\";import CryptoJS from'crypto-js';import Part3Item from'./shared/Part3Item';import Footer from'components/Footer';import{getPart}from'store/selectors/selectors';import{updatePartAction}from'store/actionTypes/actionType';import{useDispatch,useSelector}from'react-redux';var TestFlatList=styled(FlatList)(_templateObject());var Part3=function Part3(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),testList=_useState2[0],setTestList=_useState2[1];var _useState3=useState(-1),_useState4=_slicedToArray(_useState3,2),correctNumber=_useState4[0],setCorrectNumber=_useState4[1];var _useState5=useState(-1),_useState6=_slicedToArray(_useState5,2),totalNumber=_useState6[0],setTotalNumber=_useState6[1];var dispatch=useDispatch();var _useParams=useParams(),testNumber=_useParams.testNumber;var testName=\"test\".concat(testNumber);var part=useSelector(getPart(testName,'part3'));useEffect(function(){getData(testNumber,part);},[]);var getData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(testNumber,part){var itemTypes,data,plainData,json;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:itemTypes=part&&part.questions&&part.questions.length>0?part.questions:[];if(!(itemTypes.length>0)){_context.next=5;break;}setTestList(itemTypes);_context.next=12;break;case 5:_context.next=7;return textAPI.get(testNumber,3);case 7:data=_context.sent;plainData=CryptoJS.AES.decrypt(data,'thieumao').toString(CryptoJS.enc.Utf8);json=JSON.parse(plainData);setTestList(json);updateDatabase(testName,json);case 12:case\"end\":return _context.stop();}}},_callee);}));return function getData(_x,_x2){return _ref.apply(this,arguments);};}();var updateDatabase=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(testName,partQuestions){var partDetail;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:partDetail={name:'Part 3',questions:partQuestions};dispatch(updatePartAction(testName,'part3',partDetail));case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function updateDatabase(_x3,_x4){return _ref2.apply(this,arguments);};}();var onSelectAnswer=function onSelectAnswer(detailItem,questionPosition,selected,part3Index){var arr=testList||[];if(arr[part3Index].questions[questionPosition].selected!=selected){arr[part3Index].questions[questionPosition].selected=selected;}else{arr[part3Index].questions[questionPosition].selected=undefined;}updateDatabase(testName,arr);};var onReset=function onReset(){var arr=testList||[];var _iterator=_createForOfIteratorHelper(arr),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var test=_step.value;test.submitted=false;test.isShownTranslate=false;var questions=test.questions?test.questions:[];var _iterator2=_createForOfIteratorHelper(questions),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var question=_step2.value;var item=question;if(item){item.submitted=false;item.selected=false;}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}}}catch(err){_iterator.e(err);}finally{_iterator.f();}updateDatabase(testName,arr);setCorrectNumber(-1);};var onSubmit=function onSubmit(){calculateScore();var arr=testList||[];var _iterator3=_createForOfIteratorHelper(arr),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var test=_step3.value;var questions=test.questions?test.questions:[];var _iterator4=_createForOfIteratorHelper(questions),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var question=_step4.value;var item=question;if(item&&item.selected){test.submitted=true;test.isShownTranslate=true;item.submitted=true;}}}catch(err){_iterator4.e(err);}finally{_iterator4.f();}}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}updateDatabase(testName,arr);};var calculateScore=function calculateScore(){var correctCount=0;var count=0;var _iterator5=_createForOfIteratorHelper(testList),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var test=_step5.value;var questions=test.questions?test.questions:[];var _iterator6=_createForOfIteratorHelper(questions),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var question=_step6.value;count+=1;var item=question;if(item&&item.selected){if(item.selected==item.correct){correctCount+=1;}else{}}else{}}}catch(err){_iterator6.e(err);}finally{_iterator6.f();}}}catch(err){_iterator5.e(err);}finally{_iterator5.f();}setCorrectNumber(correctCount);setTotalNumber(count);};var renderItem=function renderItem(_ref3){var index=_ref3.index;var item=testList[index];return/*#__PURE__*/React.createElement(Part3Item,{data:item,part3Index:index,testNumber:testNumber,onSelectAnswer:onSelectAnswer,onCollapse:function onCollapse(){return null;},onCollapseTranslation:function onCollapseTranslation(){return null;}});};return/*#__PURE__*/React.createElement(Screen,{canBack:true,title:\"Test \".concat(testNumber,\" - Part 3\"),showMenu:false},/*#__PURE__*/React.createElement(TestFlatList,{data:testList,renderItem:renderItem,keyExtractor:function keyExtractor(item,index){return\"\".concat(index,\"_\").concat(item);}}),/*#__PURE__*/React.createElement(Footer,{correctNumber:correctNumber,totalNumber:totalNumber,onReset:onReset,onSubmit:onSubmit}));};export default Part3;","map":{"version":3,"sources":["/Users/thieunguyen/Desktop/Project/ReactJS/web-ets-2020/src/containers/Part3/index.tsx"],"names":["Screen","React","useState","useEffect","FlatList","styled","useParams","textAPI","CryptoJS","Part3Item","Footer","getPart","updatePartAction","useDispatch","useSelector","TestFlatList","Part3","testList","setTestList","correctNumber","setCorrectNumber","totalNumber","setTotalNumber","dispatch","testNumber","testName","part","getData","itemTypes","questions","length","get","data","plainData","AES","decrypt","toString","enc","Utf8","json","JSON","parse","updateDatabase","partQuestions","partDetail","name","onSelectAnswer","detailItem","questionPosition","selected","part3Index","arr","undefined","onReset","test","submitted","isShownTranslate","question","item","onSubmit","calculateScore","correctCount","count","correct","renderItem","index"],"mappings":"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","sourcesContent":["import Screen from '../Screen';\nimport React, { FC, useState, useEffect } from 'react';\nimport { FlatList } from 'react-native';\nimport styled from 'styled-components/native';\nimport { useParams } from 'react-router-dom';\nimport textAPI from \"../../api/textAPI\";\nimport CryptoJS from 'crypto-js';\nimport Part3Item from './shared/Part3Item';\nimport Footer from 'components/Footer';\nimport { getPart } from 'store/selectors/selectors';\nimport { updatePartAction } from 'store/actionTypes/actionType';\nimport { useDispatch, useSelector } from 'react-redux';\n\nconst TestFlatList = styled(FlatList as new () => FlatList<string>)`\n  width: 100%;\n  height: 100%;\n`;\n\nconst Part3: FC = () => {\n  const [testList, setTestList] = useState<any[]>([]);\n  const [correctNumber, setCorrectNumber] = useState<number>(-1);\n  const [totalNumber, setTotalNumber] = useState<number>(-1);\n\n  const dispatch = useDispatch();\n  const { testNumber } = useParams();\n  const testName = `test${testNumber}`;\n  const part  = useSelector(getPart(testName, 'part3'));\n  useEffect(() => {\n    getData(testNumber, part);\n  }, []);\n\n  const getData = async (testNumber: number, part: any) => {\n    const itemTypes: any[] = (part && part.questions && part.questions.length > 0) ? part.questions : [];\n    if (itemTypes.length > 0) {\n      setTestList(itemTypes);\n    } else {\n      const data = await textAPI.get(testNumber, 3);\n      const plainData = CryptoJS.AES.decrypt(data, 'thieumao').toString(CryptoJS.enc.Utf8);\n      const json = JSON.parse(plainData);\n      setTestList(json);\n      updateDatabase(testName, json);\n    }\n  };\n\n  const updateDatabase = async (testName: string, partQuestions: any[]) => {\n    const partDetail = {\n      name: 'Part 3',\n      questions: partQuestions,\n    };\n    dispatch(updatePartAction(testName, 'part3', partDetail));\n  };\n\n  const onSelectAnswer = (detailItem: any, questionPosition: number, selected: string, part3Index: number) => {\n    let arr = testList || [];\n    if (arr[part3Index].questions[questionPosition].selected != selected) {\n      arr[part3Index].questions[questionPosition].selected = selected;\n    } else {\n      arr[part3Index].questions[questionPosition].selected = undefined;\n    }\n    updateDatabase(testName, arr);\n  };\n\n  const onReset = () => {\n    let arr = testList || [];\n    for (let test of arr) {\n      test.submitted = false;\n      test.isShownTranslate = false;\n      const questions = (test.questions) ? test.questions : [];\n      for (const question of questions) {\n        const item = question;\n        if (item) {\n          item.submitted = false;\n          item.selected = false;\n        }\n      }\n    }\n    updateDatabase(testName, arr);\n\n    setCorrectNumber(-1);\n  };\n\n  const onSubmit = () => {\n    calculateScore();\n    let arr = testList || [];\n    for (let test of arr) {\n      const questions = (test.questions) ? test.questions : [];\n      for (const question of questions) {\n        const item = question;\n        if (item && item.selected) {\n          test.submitted = true;\n          test.isShownTranslate = true;\n          item.submitted = true;\n        }\n      }\n    }\n    updateDatabase(testName, arr);\n  };\n\n  const calculateScore = () => {\n    let correctCount = 0;\n    let count = 0;\n    for (const test of testList) {\n      const questions = (test.questions) ? test.questions : []; \n      for (const question of questions) {\n        count += 1;\n        const item = question;\n        if (item && item.selected) {\n          if (item.selected == item.correct) {\n            correctCount += 1;\n          } else {\n          }\n        } else {\n        }\n      }\n    }\n    setCorrectNumber(correctCount);\n    setTotalNumber(count);\n  };\n\n  const renderItem = ({ index }: { item: any; index: number }) => {\n    const item = testList[index];\n    return (\n      <Part3Item\n        data={item}\n        part3Index={index}\n        testNumber={testNumber}\n        onSelectAnswer={onSelectAnswer}\n        onCollapse={() => null}\n        onCollapseTranslation={() => null}\n      />\n    );\n  };\n\n  return (\n      <Screen canBack title={`Test ${testNumber} - Part 3`} showMenu={false}>\n        <TestFlatList\n          data={testList}\n          renderItem={renderItem}\n          keyExtractor={(item, index) => `${index}_${item}`}\n        />\n        <Footer correctNumber={correctNumber} totalNumber={totalNumber} onReset={onReset} onSubmit={onSubmit} />\n      </Screen>\n  );\n};\n\nexport default Part3;\n"]},"metadata":{},"sourceType":"module"}