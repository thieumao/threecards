{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.enhanceReducer = undefined;\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _constants = require('./constants');\n\nfunction _objectWithoutProperties(obj, keys) {\n  var target = {};\n\n  for (var i in obj) {\n    if (keys.indexOf(i) >= 0) continue;\n    if (!Object.prototype.hasOwnProperty.call(obj, i)) continue;\n    target[i] = obj[i];\n  }\n\n  return target;\n}\n\nfunction _toArray(arr) {\n  return Array.isArray(arr) ? arr : Array.from(arr);\n}\n\nfunction _toConsumableArray(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n}\n/* global */\n\n\nvar enqueue = function enqueue(state, action) {\n  var transaction = state.lastTransaction + 1;\n\n  var stamped = _extends({}, action, {\n    meta: _extends({}, action.meta, {\n      transaction: transaction\n    })\n  });\n\n  var outbox = state.outbox;\n  return _extends({}, state, {\n    lastTransaction: transaction,\n    outbox: [].concat(_toConsumableArray(outbox), [stamped])\n  });\n};\n\nvar dequeue = function dequeue(state) {\n  var _state$outbox = _toArray(state.outbox),\n      rest = _state$outbox.slice(1);\n\n  return _extends({}, state, {\n    outbox: rest,\n    retryCount: 0,\n    busy: false\n  });\n};\n\nvar initialState = {\n  busy: false,\n  lastTransaction: 0,\n  online: false,\n  outbox: [],\n  receipts: [],\n  retryToken: 0,\n  retryCount: 0,\n  retryScheduled: false\n}; // @TODO: the typing of this is all kinds of wack\n\nvar offlineUpdater = function offlineUpdater() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState;\n  var action = arguments[1]; // Update online/offline status\n\n  if (action.type === _constants.OFFLINE_STATUS_CHANGED && action.payload && typeof action.payload.online === 'boolean') {\n    return _extends({}, state, {\n      online: action.payload.online\n    });\n  }\n\n  if (action.type === _constants.PERSIST_REHYDRATE) {\n    return _extends({}, state, {\n      busy: false\n    });\n  }\n\n  if (action.type === _constants.OFFLINE_SCHEDULE_RETRY) {\n    return _extends({}, state, {\n      busy: false,\n      retryScheduled: true,\n      retryCount: state.retryCount + 1,\n      retryToken: state.retryToken + 1\n    });\n  }\n\n  if (action.type === _constants.OFFLINE_COMPLETE_RETRY) {\n    return _extends({}, state, {\n      retryScheduled: false\n    });\n  }\n\n  if (action.type === _constants.OFFLINE_BUSY && action.payload && typeof action.payload.busy === 'boolean') {\n    return _extends({}, state, {\n      busy: action.payload.busy\n    });\n  } // Add offline actions to queue\n\n\n  if (action.meta && action.meta.offline) {\n    return enqueue(state, action);\n  } // Remove completed actions from queue (success or fail)\n\n\n  if (action.meta != null && action.meta.completed === true) {\n    return dequeue(state);\n  }\n\n  return state;\n};\n\nvar enhanceReducer = function enhanceReducer(reducer) {\n  return function (state, action) {\n    var offlineState = void 0;\n    var restState = void 0;\n\n    if (typeof state !== 'undefined') {\n      var offline = state.offline,\n          rest = _objectWithoutProperties(state, ['offline']);\n\n      offlineState = offline;\n      restState = rest;\n    }\n\n    return _extends({}, reducer(restState, action), {\n      offline: offlineUpdater(offlineState, action)\n    });\n  };\n};\n\nexports.enhanceReducer = enhanceReducer;","map":{"version":3,"sources":["/Users/thieunguyen/Desktop/Project/ReactJS/web-ets-2020/node_modules/redux-offline/lib/updater.js"],"names":["Object","defineProperty","exports","value","enhanceReducer","undefined","_extends","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","_constants","require","_objectWithoutProperties","obj","keys","indexOf","_toArray","arr","Array","isArray","from","_toConsumableArray","arr2","enqueue","state","action","transaction","lastTransaction","stamped","meta","outbox","concat","dequeue","_state$outbox","rest","slice","retryCount","busy","initialState","online","receipts","retryToken","retryScheduled","offlineUpdater","type","OFFLINE_STATUS_CHANGED","payload","PERSIST_REHYDRATE","OFFLINE_SCHEDULE_RETRY","OFFLINE_COMPLETE_RETRY","OFFLINE_BUSY","offline","completed","reducer","offlineState","restState"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.enhanceReducer = undefined;\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _constants = require('./constants');\n\nfunction _objectWithoutProperties(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }\n\nfunction _toArray(arr) { return Array.isArray(arr) ? arr : Array.from(arr); }\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\n/* global */\n\nvar enqueue = function enqueue(state, action) {\n  var transaction = state.lastTransaction + 1;\n  var stamped = _extends({}, action, { meta: _extends({}, action.meta, { transaction: transaction }) });\n  var outbox = state.outbox;\n  return _extends({}, state, {\n    lastTransaction: transaction,\n    outbox: [].concat(_toConsumableArray(outbox), [stamped])\n  });\n};\n\nvar dequeue = function dequeue(state) {\n  var _state$outbox = _toArray(state.outbox),\n      rest = _state$outbox.slice(1);\n\n  return _extends({}, state, { outbox: rest, retryCount: 0, busy: false });\n};\n\nvar initialState = {\n  busy: false,\n  lastTransaction: 0,\n  online: false,\n  outbox: [],\n  receipts: [],\n  retryToken: 0,\n  retryCount: 0,\n  retryScheduled: false\n};\n\n// @TODO: the typing of this is all kinds of wack\n\nvar offlineUpdater = function offlineUpdater() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState;\n  var action = arguments[1];\n\n  // Update online/offline status\n  if (action.type === _constants.OFFLINE_STATUS_CHANGED && action.payload && typeof action.payload.online === 'boolean') {\n    return _extends({}, state, { online: action.payload.online });\n  }\n\n  if (action.type === _constants.PERSIST_REHYDRATE) {\n    return _extends({}, state, { busy: false });\n  }\n\n  if (action.type === _constants.OFFLINE_SCHEDULE_RETRY) {\n    return _extends({}, state, {\n      busy: false,\n      retryScheduled: true,\n      retryCount: state.retryCount + 1,\n      retryToken: state.retryToken + 1\n    });\n  }\n\n  if (action.type === _constants.OFFLINE_COMPLETE_RETRY) {\n    return _extends({}, state, { retryScheduled: false });\n  }\n\n  if (action.type === _constants.OFFLINE_BUSY && action.payload && typeof action.payload.busy === 'boolean') {\n    return _extends({}, state, { busy: action.payload.busy });\n  }\n\n  // Add offline actions to queue\n  if (action.meta && action.meta.offline) {\n    return enqueue(state, action);\n  }\n\n  // Remove completed actions from queue (success or fail)\n  if (action.meta != null && action.meta.completed === true) {\n    return dequeue(state);\n  }\n\n  return state;\n};\n\nvar enhanceReducer = function enhanceReducer(reducer) {\n  return function (state, action) {\n    var offlineState = void 0;\n    var restState = void 0;\n    if (typeof state !== 'undefined') {\n      var offline = state.offline,\n          rest = _objectWithoutProperties(state, ['offline']);\n\n      offlineState = offline;\n      restState = rest;\n    }\n\n    return _extends({}, reducer(restState, action), {\n      offline: offlineUpdater(offlineState, action)\n    });\n  };\n};\nexports.enhanceReducer = enhanceReducer;"]},"metadata":{},"sourceType":"script"}